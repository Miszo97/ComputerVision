{% load static %}

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Examples selection page</title>
    <link href="{% static 'number_recognition/examples_selection_styles.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>

<div class="container">

    <form id='deleted-examples-form' action="{% url 'number_recognition:update_examples' %}" method="post">
        {% csrf_token %}
        <input type="hidden" id="deleted-examples" name="deleted-examples">
    </form>

    <input type="button" id="update-examples-button" value="Update!" onclick="updateExamples()">

    <div id="user-examples-gallery">

    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>


</body>
</html>

<script src="{% static 'number_recognition/examples_selection_scripts.js' %}"></script>
<script>
    let userExamplesGallery, div, label, img, discardButton, exampleCanvas, pk, id, deletedExamples = [];


    {% for example in examples %}

        {{ example.label }}

        userExamplesGallery = document.getElementById('user-examples-gallery');

        div = document.createElement('div');
        div.id = 'user-example-instance_' + {{example.pk}};
        div.className = 'user-example-instance';

        discardButton = document.createElement('button');
        discardButton.innerText = 'Discard!';
        discardButton.onclick = () => {
            pk = {{example.pk}};
            id = 'user-example-instance_' + pk;
            userExamplesGallery.removeChild(document.getElementById(id));
            deletedExamples.push(pk);
        };

        exampleCanvas = document.createElement('canvas');


        exampleCanvas.style.border = '1px solid blue';
        exampleCanvas.width = 200;
        exampleCanvas.height = 200;
        img = new Image;

        img.src = '{{ example.drawing_base64 }}'

        exampleCanvas.getContext('2d').drawImage(img, 0, 0);

        label = document.createElement('p');
        label.innerText = {{ example.label }};

        div.appendChild(exampleCanvas);
        div.appendChild(label);
        div.appendChild(discardButton);
        userExamplesGallery.appendChild(div);

    {% endfor %}
</script>
